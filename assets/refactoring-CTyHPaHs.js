import{r as u,j as e,c as q,R as E}from"./client-DD4c7S6m.js";const V=t=>{const s=D(t);return t.product.price*(1-s)*t.quantity},D=t=>{const s=t.product.discounts.filter(a=>a.quantity<=t.quantity).map(a=>a.rate);return s.length===0?0:Math.max(...s)},M=t=>t>0,R=(t,s)=>{const a=t.reduce((m,i)=>m+i.quantity*i.product.price,0),n=t.reduce((m,i)=>m+V(i),0),o=(m,i)=>m*(1-i/100),c=(m,i)=>Math.max(m-i,0),r=s?((m,i)=>{if(m.discountType==="amount")return c(i,m.discountValue);if(m.discountType==="percentage")return o(i,m.discountValue)})(s,n)??n:n,l=a-r;return{totalBeforeDiscount:a??0,totalAfterDiscount:r??0,totalDiscount:l??0}},w=(t,s,a)=>{var o;const n=(o=t.find(c=>c.product.id===s))==null?void 0:o.product.stock;return n&&n<a?t.map(c=>c.product.id===s?{...c,quantity:n}:c):a===0?t.filter(c=>c.product.id!==s):t.map(c=>c.product.id===s?{...c,quantity:a}:c)},O=()=>{const[t,s]=u.useState([]),[a,n]=u.useState(null),o=u.useCallback(i=>{s(x=>{const h=[...x],p=h.findIndex(b=>b.product.id===i.id);if(p!==-1){const b=h[p],j=Math.min(b.quantity+1,i.stock);return h[p]={...b,quantity:j},h}return[...h,{product:i,quantity:1}]})},[]),c=u.useCallback(i=>{s(x=>w(x,i,0))},[]),d=i=>{const x=t.find(h=>h.product.id===i.id);return i.stock-((x==null?void 0:x.quantity)||0)},r=u.useCallback((i,x)=>{s(h=>w(h,i,x))},[]),l=u.useCallback(i=>{n(i)},[]);return{cart:t,addToCart:o,removeFromCart:c,getRemainingStock:d,updateQuantity:r,applyCoupon:l,calculateTotal:()=>R(t,a),selectedCoupon:a}},$=t=>{const[s,a]=u.useState(t),n=u.useCallback(o=>{a(c=>[...c,o])},[]);return{coupons:s,addCoupon:n}},B=t=>{const[s,a]=u.useState(t),n=u.useCallback(c=>{a(d=>[...d,c])},[]),o=u.useCallback(c=>{a(d=>d.map(r=>r.id===c.id?c:r))},[]);return{products:s,updateProduct:o,addProduct:n}},f=t=>t.toLocaleString(),g=t=>t*100,y=(t,s)=>t.toFixed(s);function F(t,s){let a;return(...n)=>{clearTimeout(a),a=setTimeout(()=>{t(...n)},s)}}const U=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],v={name:"",price:0,stock:0,discounts:[]},C=t=>t.length>0,L=(t,s)=>{const a=t.discounts.filter((n,o)=>o!==s);return{...t,discounts:a}},H=(t,s)=>({...t,discounts:[...t.discounts,s]}),P={quantity:0,rate:0},K=t=>t.reduce((s,a)=>Math.max(s,a.rate),0),_=({product:t,remainingStock:s,addToCart:a})=>e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[f(t.price),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),C(t.discounts)&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대"," ",y(g(K(t.discounts)),0),"% 할인"]})]}),C(t.discounts)&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((n,o)=>e.jsxs("li",{children:[n.quantity,"개 이상:"," ",y(g(n.rate),0),"% 할인"]},o))}),e.jsx("button",{onClick:()=>a(t),className:`w-full px-3 py-1 rounded ${s>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})]},t.id),I=t=>{const[s,a]=u.useState(""),[n,o]=u.useState(t),c=u.useMemo(()=>F(d=>{d.trim()?o(t.filter(r=>r.name.toLowerCase().includes(d.toLowerCase()))):o(t)},300),[t]);return u.useEffect(()=>{c(s)},[s,c]),{keyword:s,setKeyword:a,filteredProducts:n}},A=({keyword:t,setKeyword:s})=>e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("input",{type:"text",value:t,onChange:a=>s(a.target.value),placeholder:"상품명 검색",className:"p-2 border rounded w-60"})}),J=({products:t,addToCart:s,getRemainingStock:a})=>{const{keyword:n,setKeyword:o,filteredProducts:c}=I(t);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx(A,{keyword:n,setKeyword:o})]}),e.jsx("div",{className:"space-y-2",children:c.map(d=>e.jsx(_,{product:d,addToCart:s,remainingStock:a(d)},d.id))})]})},z=({cart:t,removeFromCart:s,updateQuantity:a})=>e.jsx("div",{className:"space-y-2",children:t.map(n=>{const o=D(n);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:n.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[n.product.price,"원 x ",n.quantity,M(o)&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",y(g(o),0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>a(n.product.id,n.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>a(n.product.id,n.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>s(n.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},n.product.id)})}),G=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],k={name:"",code:"",discountType:"percentage",discountValue:0},S=t=>t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`,W=({coupons:t,applyCoupon:s,selectedCoupon:a})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:n=>s(t[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((n,o)=>e.jsxs("option",{value:o,children:[n.name," - ",S(n)]},n.code))]}),a&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",a.name,"(",S(a)," ","할인)"]})]}),Y=({cartBills:t})=>{const{totalDiscount:s,totalAfterDiscount:a,totalBeforeDiscount:n}=t;return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",f(n),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",f(s),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",f(a),"원"]})]})]})},Q=({products:t,coupons:s})=>{const{cart:a,addToCart:n,removeFromCart:o,getRemainingStock:c,updateQuantity:d,applyCoupon:r,calculateTotal:l,selectedCoupon:m}=O();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(J,{products:t,addToCart:n,getRemainingStock:c}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx(z,{cart:a,removeFromCart:o,updateQuantity:d}),e.jsx(W,{coupons:s,applyCoupon:r,selectedCoupon:m}),e.jsx(Y,{cartBills:l()})]})]})]})},X=t=>{const[s,a]=u.useState(t),n=u.useCallback(o=>{a(c=>o)},[]);return{showNewProductForm:s,updateShowFormFlag:n}},T=()=>({getItem:n=>{const o=localStorage.getItem(n);return o?JSON.parse(o):null},setItem:(n,o)=>{localStorage.setItem(n,JSON.stringify(o))},removeItem:n=>{localStorage.removeItem(n)}}),N="draftProduct",Z=(t,s)=>{const{getItem:a,setItem:n,removeItem:o}=T(),[c,d]=u.useState(()=>{const p=a(N);return p||v}),[r,l]=u.useState(!1),m=(p,b)=>{const j={...c,[p]:b};d(j),i(j)},i=u.useMemo(()=>F(p=>{n(N,p),l(!0),setTimeout(()=>l(!1),2500)},5e3),[]);return{newProduct:c,updateNewProduct:m,handleAddNewProduct:()=>{const p={...c,id:Date.now().toString()};t(p),d(v),o(N),s(!1)},resetForm:()=>{o(N),d(v)},showSnackbar:r}},ee=({onProductAdd:t})=>{const{showNewProductForm:s,updateShowFormFlag:a}=X(!1),{newProduct:n,updateNewProduct:o,handleAddNewProduct:c,resetForm:d,showSnackbar:r}=Z(t,a);return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{s&&d(),a(!s)},className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:s?"취소":"새 상품 추가"}),s&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:n.name,onChange:l=>o("name",l.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:n.price,onChange:l=>o("price",parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:n.stock,onChange:l=>o("stock",parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:c,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),r&&e.jsx("div",{className:"fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded shadow-lg z-50 animate-fade-in-out",children:"입력 내용이 자동 저장되었습니다"})]})},te=()=>{const[t,s]=u.useState(P);return{newDiscount:t,updateDiscountField:(o,c)=>{s(d=>({...d,[o]:c}))},resetDiscountValues:()=>{s(P)}}};function se({editingProduct:t,setEditingProduct:s,onProductUpdate:a}){const{newDiscount:n,updateDiscountField:o,resetDiscountValues:c}=te(),d=()=>{const r=H(t,n);console.log("updatedProduct",r),s(r),a(r),c()};return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:n.quantity,onChange:r=>o("quantity",parseInt(r.target.value)),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:g(n.rate),onChange:r=>o("rate",parseInt(r.target.value)/100),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:d,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})}const ne=({editingProduct:t,setEditingProduct:s,onProductUpdate:a})=>{const n=o=>{const c=L(t,o);a(c),s(c)};return e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),t.discounts.map((o,c)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[o.quantity,"개 이상 구매 시 ",g(o.rate),"% 할인"]}),e.jsx("button",{onClick:()=>n(c),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},c)),e.jsx(se,{editingProduct:t,setEditingProduct:s,onProductUpdate:a})]})},ae=(t,s)=>{const[a,n]=u.useState(t);return{editingProduct:a,setEditingProduct:n,handleProductNameUpdate:r=>{const l={...a,name:r};n(l)},handlePriceUpdate:r=>{const l={...a,price:r};n(l)},handleStockUpdate:r=>{const l={...a,stock:r};n(l),s(l)}}},oe=({product:t,onProductUpdate:s,handleEditComplete:a})=>{const{editingProduct:n,setEditingProduct:o,handleProductNameUpdate:c,handlePriceUpdate:d,handleStockUpdate:r}=ae(t,s);return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:n.name,onChange:l=>c(l.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:n.price,onChange:l=>d(parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:n.stock,onChange:l=>r(parseInt(l.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx(ne,{editingProduct:n,setEditingProduct:o,onProductUpdate:s}),e.jsx("button",{onClick:()=>{a(n)},className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]})},ce=(t=!1)=>{const[s,a]=u.useState(t),n=u.useCallback(()=>{a(o=>!o)},[]);return{isOpen:s,updateIsOpenFlag:n}},re=(t,s=!1)=>{const[a,n]=u.useState(s);function o(){a||n(!0)}return{isEditing:a,openEditMode:o,handleEditComplete:d=>{if(a){t(d),n(!1);return}}}},de=({product:t,index:s,onProductUpdate:a})=>{const{isOpen:n,updateIsOpenFlag:o}=ce(),{isEditing:c,openEditMode:d,handleEditComplete:r}=re(a);return e.jsx(e.Fragment,{children:e.jsxs("div",{"data-testid":`product-${s+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:o,className:"w-full text-left font-semibold",children:[t.name," - ",t.price,"원 (재고: ",t.stock,")"]}),n&&e.jsx("div",{className:"mt-2",children:c?e.jsx(oe,{product:t,onProductUpdate:a,handleEditComplete:r}):e.jsxs("div",{children:[t.discounts.map((l,m)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[l.quantity,"개 이상 구매 시"," ",g(l.rate),"% 할인"]})},m)),e.jsx("button",{"data-testid":"modify-button",onClick:d,className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},t.id)})},le=({products:t,onProductUpdate:s,onProductAdd:a})=>{const{keyword:n,setKeyword:o,filteredProducts:c}=I(t);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(A,{keyword:n,setKeyword:o})]}),e.jsx(ee,{onProductAdd:a}),e.jsx("div",{className:"space-y-2",children:c.map((d,r)=>e.jsx(de,{product:d,index:r,onProductUpdate:s},d.id))})]})},ue=t=>{const[s,a]=u.useState(k),n=u.useCallback((c,d)=>{a(r=>({...r,[c]:d}))},[]),o=u.useCallback(()=>{t(s),a(k)},[s,t]);return{newCoupon:s,updateNewCoupon:n,handleAddCoupon:o}},ie=({onCouponAdd:t})=>{const{newCoupon:s,updateNewCoupon:a,handleAddCoupon:n}=ue(t);return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:s.name,onChange:o=>a("name",o.target.value),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:s.code,onChange:o=>a("code",o.target.value),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.discountType,onChange:o=>a("discountType",o.target.value),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:s.discountValue,onChange:o=>a("discountValue",parseInt(o.target.value)),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:n,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]})},me=({coupon:t,index:s})=>e.jsxs("div",{"data-testid":`coupon-${s+1}`,className:"bg-gray-100 p-2 rounded",children:[t.name," (",t.code,"):",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," ","할인"]},s),pe=({coupons:t,onCouponAdd:s})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(ie,{onCouponAdd:s}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((a,n)=>e.jsx(me,{coupon:a,index:n},n))})]})]})]}),xe=({products:t,coupons:s,onProductUpdate:a,onProductAdd:n,onCouponAdd:o})=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(le,{products:t,onProductUpdate:a,onProductAdd:n}),e.jsx(pe,{coupons:s,onCouponAdd:o})]})]}),he=({isAdmin:t,switchPage:s})=>e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:s,className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:t?"장바구니 페이지로":"관리자 페이지로"})]})}),be=t=>{const[s,a]=u.useState(t);function n(){a(o=>!o)}return{isAdmin:s,switchPage:n}},ge=()=>{const{isAdmin:t,switchPage:s}=be(!1),{getItem:a,setItem:n}=T();n("products",U),n("coupons",G);const{products:o,updateProduct:c,addProduct:d}=B(a("products")),{coupons:r,addCoupon:l}=$(a("coupons"));return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx(he,{isAdmin:t,switchPage:s}),e.jsx("main",{className:"container mx-auto mt-6",children:t?e.jsx(xe,{products:o,coupons:r,onProductUpdate:c,onProductAdd:d,onCouponAdd:l}):e.jsx(Q,{products:o,coupons:r})})]})};q.createRoot(document.getElementById("root")).render(e.jsx(E.StrictMode,{children:e.jsx(ge,{})}));
